---
title: 关于视频中间件格式的选用 及 编码挖坑避险办事处
tags: ["Ae","工作流程","计算机","影視"]
updated: 2020-01-16
date: 2020-01-16
categories: "影視"
---
---
## 起因

前几天和某君协同做一个视频，一部分模板交给他负责，最后给了我一个mp4。好在甲方爸爸不在乎这点画质，后来在微信略微交流到关于中间交换格式，在这里整理下。

### TL;DR

比较合适用来作为视频交付中间件的格式有：DNxHR、cineForm、png序列
<!--more-->
## 视频中间件

由于从单人制作慢慢演变为团队协作，成员之间开始有任务分发和交付。通常会是一个人负责主导（执行导演或剪辑师），另外就是负责完成分发任务与交付。这里探讨**主从结构**的“从”部分

这里完成可靠交付的方式有几个要求：

1. 需要可以承载足够高的质量，以便于呈现或修改

2. 应对修改需求，需要尽可能快地完成交付

3. 不会一次性有太大的原件占用空间，多次修改不会撑爆硬盘

## 测试结果与概念解释

拿了之前做过的几个模板和改过的几个模板都做了测试，在包含运动模糊、透明、各种效果器变换的情况下做了测试，得到大概以下结果：

![](/asset/images/毕业后/midrender/03.png)

其中有几个概念要解释下

1. 不是文件越大质量越好

    > 比如tiff巨大的文件里，花费了许多空间来记录透明的像素点，是很没有必要的

2. 有损或无损压缩、帧间编码，都是比较耗费时间的，压缩越小越耗费时间。

    > 此处不压缩，辛苦的就是最终合成的那位，如果有必要分担一些，可以选择较小一点的压缩量。

3. 像H.264不自带透明通道，可以单独渲染一个透明通道，两个一起交付，再用遮罩合成即可

4. **帧内编码**指单独对一个帧进行编码，**帧间编码**指根据前后帧使用比如记录差值等编码方式。

    > 前者质量高、体积大、读取时候吃读速不吃CPU，后者质量有限、体积小、读取时候吃CPU不吃读速。
    > 另外，把**帧间编码**的文件作为素材，编码的时候：先解码->再编码，质量上会有变化
    > **帧内编码**的文件直接进行编码，质量稳定

5. 看甲方需求的频繁程度，之前遇到过中间件png序列文件靠修改堆上100G的甲方

6. 超过三十分钟的渲染，如果没有Ups，还是换用图片序列吧。另外图片序列…可以分给多个机器跑，在有渲染农场的场合就特别实用，直接写个脚本调用``aerender.exe``就行

7. 新的adobe默认不支持带透明的QuickTime素材，替代方案有：
    
    > 图片序列
    > H.264/5编码+透明通道遮罩
    > 带黑底素材+UnMult

8. 另：以上编码除了h.264，都已支持超过4K大小的视频

## 总结

比较合适用来作为视频交付中间件的格式有：DNxHR、cineForm、png序列

## 其他

平时一些经验的总结详见[Ae提速挖坑指北](/post/%E5%BD%B1%E8%A7%86/aeup/index.html)、[关于视频制作中模糊算法的比对及ae渲染机制的结合分析](/post/%E5%BD%B1%E8%A7%86/blur/index.html)